<!-- ═══════════ POOL + NORM ═══════════ -->
<div class="view" id="v-pool">
  <p class="mono" style="margin-bottom:0.4rem;">데이터 처리</p>
  <h2>풀링과 정규화</h2>
  <p class="desc">
    풀링은 이미지 크기를 줄이면서 핵심 정보를 보존하고,
    정규화는 학습 효율을 높이기 위해 값의 범위를 조정합니다.
  </p>

  <div class="card">
    <h3>왜 데이터를 줄이고 변환해야 할까?</h3>
    <p>스마트폰으로 찍은 사진 한 장은 보통 1,200만 개 이상의 픽셀로 이루어져 있습니다.
      이 모든 픽셀을 그대로 처리하면 연산량이 폭발적으로 늘어납니다.
      풀링은 이미지의 핵심 특징은 유지하면서 크기를 줄이는 기법으로, CNN의 각 합성곱층 뒤에 배치되어
      연산 효율을 높이고, 작은 위치 변화에 흔들리지 않는 안정적인 인식을 가능하게 합니다.</p>
    <p style="margin-top:0.5rem;">정규화는 서로 다른 범위의 데이터를 일정한 범위로 맞추는 과정입니다.
      키(cm)와 몸무게(kg)처럼 단위가 다른 데이터를 함께 학습시키려면 같은 스케일로 변환해야
      특정 값이 학습을 지배하는 것을 방지할 수 있습니다.</p>
  </div>

  <div class="tabs">
    <button class="tab on" onclick="ptab(0,this)">맥스 풀링</button>
    <button class="tab" onclick="ptab(1,this)">정규화</button>
  </div>

  <!-- TAB 0: pooling -->
  <div class="tpanel on" id="pt0">
    <div class="card">
      <h3>맥스 풀링 (Max Pooling)</h3>
      <p>4×4 입력에서 2×2씩 묶어 최대값만 선택하여 2×2로 압축합니다.
        입력값을 직접 편집하여 다양한 경우를 실험해보세요.</p>
    </div>

    <div class="grid-wrap">
      <div style="text-align:center;"><p class="mat-label">입력 (4×4) — 편집 가능</p><div class="eg" id="pi" style="grid-template-columns:repeat(4,1fr);"></div></div>
      <div class="op">→</div>
      <div style="text-align:center;"><p class="mat-label">출력 (2×2)</p><div class="mat" id="po" style="grid-template-columns:repeat(2,1fr);"></div></div>
    </div>
    <div class="btn-row" style="justify-content:center;">
      <button class="btn" onclick="pRst()">리셋</button>
      <button class="btn" onclick="pStp()">한 단계</button>
      <button class="btn pri" onclick="pAut()">자동 실행</button>
    </div>
    <div id="pst" class="status" style="text-align:center;"></div>
    <div class="info">
      <strong>효과:</strong> 이미지 크기는 줄지만 주요 특징은 유지됩니다.
      연산량을 줄이고, 물체 위치가 조금 바뀌어도 동일하게 인식하는 이동 불변성을 제공합니다.
    </div>
  </div>

  <!-- TAB 1: normalization -->
  <div class="tpanel" id="pt1">
    <div class="card">
      <h3>데이터 정규화 (Normalization)</h3>
      <p>이미지 픽셀은 0(검은색)~255(흰색)의 정수값을 가집니다.
        AI 모델 학습 시 0.0~1.0 사이의 실수로 변환합니다. 이는 행렬의 실수배 연산입니다.</p>
    </div>
    <div class="math" style="text-align:center;">X_normalized = X / 255</div>
    <div style="text-align:center;margin:2rem 0;">
      <p class="mono" style="margin-bottom:0.6rem;">슬라이더를 움직여 정규화를 체험하세요</p>
      <input type="range" class="ns" id="nsl" min="0" max="255" value="128">
      <div class="nout">
        <div class="nb"><div class="v" id="ni">128</div><div class="l">Integer (0–255)</div></div>
        <div class="nb"><div style="font-size:1.2rem;color:var(--muted);padding-top:0.3rem;">÷ 255 =</div></div>
        <div class="nb"><div class="v" id="nf">0.502</div><div class="l">Float (0.0–1.0)</div></div>
        <div class="nb"><div class="sw" id="nsw" style="background:rgb(128,128,128);"></div><div class="l">실제 색상</div></div>
      </div>
    </div>
    <div class="info">
      <strong>왜 필요한가:</strong> 정규화를 하지 않으면, 큰 값을 가진 특성이 학습을 지배하여
      모델이 편향되게 학습될 수 있습니다. 정규화는 경사 하강법의 수렴 속도를 높이고,
      수치 오버플로우를 방지하며, 다양한 특성을 공평하게 반영할 수 있게 합니다.
      이미지 외에도 음성, 센서 데이터 등 거의 모든 AI 입력 데이터에 정규화가 적용됩니다.
    </div>
  </div>

  <div style="height:1px;background:var(--border);margin:2.4rem 0;"></div>

  <div data-no-toggle="1" id="cnn-pipeline">
    <p class="mono" style="margin-bottom:0.4rem;">CNN 파이프라인 체험</p>
    <h2 style="font-size:1.35rem;margin-top:0.2rem;">업로드한 이미지가 CNN을 지나가는 전체 과정</h2>
    <p class="desc" style="margin-top:0.6rem;">
      합성곱 → 활성화(ReLU) → 풀링 → 더 깊은 층 → 분류(Softmax)까지,
      “풀링이 왜 필요한지”를 직접 눈으로 확인할 수 있습니다.
    </p>

    <div class="card">
      <h3>이미지 업로드</h3>
      <p>이미지를 업로드하면 CNN(합성곱 신경망)이 처리하는 각 단계를 시각적으로 확인할 수 있습니다.</p>
      <div class="upz" id="cnn-upz" style="margin-top:0.8rem;">
        <p style="font-weight:500;color:var(--fg);margin-bottom:0.2rem;">이미지를 드래그하거나 클릭하여 업로드</p>
        <p style="font-size:0.7rem;margin-top:0.15rem;">jpg, png 등 이미지 파일</p>
        <input type="file" id="cnn-fup" accept="image/*">
      </div>
      <div id="cnn-status" class="status"></div>
    </div>

    <div id="cnn-controls" style="display:none;">
      <div id="cnn-timeline" style="display:flex;gap:2px;margin-bottom:0.8rem;overflow-x:auto;padding:0.3rem 0;">
        <button class="cnn-tl-btn" onclick="cnnShowStep(0)" data-step="0">입력<br>이미지</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(1)" data-step="1">Conv2D<br>합성곱</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(2)" data-step="2">ReLU<br>활성화</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(3)" data-step="3">MaxPool<br>풀링</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(4)" data-step="4">Deep<br>깊은 층</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(5)" data-step="5">Softmax<br>분류</button>
      </div>
      <div style="display:flex;justify-content:center;gap:1rem;margin-bottom:1rem;">
        <button class="btn" onclick="cnnPrevStep()">← 이전</button>
        <button class="btn pri" onclick="cnnNextStep()">다음 →</button>
      </div>
    </div>

    <div id="cnn-step-0" class="cnn-step" style="display:none;">
      <div class="card"><h3>1단계: 입력</h3>
      <p>이미지를 224×224로 조정하고 RGB 값을 정규화합니다.</p>
      <div style="text-align:center;margin:1rem 0;">
        <canvas id="cnn-input-cv" width="224" height="224" style="border-radius:var(--radius);border:1px solid var(--border);max-width:224px;"></canvas>
        <p style="font-size:0.78rem;color:var(--muted);margin-top:0.4rem;">224 × 224 × 3 (RGB)</p>
      </div></div>
    </div>

    <div id="cnn-step-1" class="cnn-step" style="display:none;">
      <div class="card"><h3>2단계: 합성곱 — 저수준 특징 추출</h3>
      <p>12개의 필터(커널)가 이미지에서 기본 패턴(가장자리, 방향, 질감)을 감지합니다. 밝은 영역 = 해당 특징이 강하게 존재하는 곳.</p>
      <div id="cnn-conv1-maps" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:1rem;justify-content:center;"></div>
      <p style="font-size:0.78rem;color:var(--muted);margin-top:0.5rem;text-align:center;" id="cnn-conv1-info"></p></div>
    </div>

    <div id="cnn-step-2" class="cnn-step" style="display:none;">
      <div class="card"><h3>3단계: ReLU 활성화</h3>
      <p>음수를 0으로 바꿔 "특징 있음/없음"으로 단순화합니다. 2단계와 비교하면 어두운(음수) 부분이 완전한 검정으로 바뀝니다.</p>
      <div class="math" style="text-align:center;">ReLU(x) = max(0, x)</div>
      <div id="cnn-relu-maps" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:1rem;justify-content:center;"></div></div>
    </div>

    <div id="cnn-step-3" class="cnn-step" style="display:none;">
      <div class="card"><h3>4단계: 맥스 풀링</h3>
      <p>2×2 영역에서 최대값만 선택하여 크기를 절반으로 줄입니다. (224×224 → 112×112)</p>
      <div id="cnn-pool-maps" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:1rem;justify-content:center;"></div>
      <p style="font-size:0.78rem;color:var(--muted);margin-top:0.5rem;text-align:center;" id="cnn-pool-info"></p></div>
    </div>

    <div id="cnn-step-4" class="cnn-step" style="display:none;">
      <div class="card"><h3>5단계: 깊은 층 — 고수준 특징</h3>
      <p>Conv→ReLU→Pool을 반복하면 점점 추상적인 패턴(눈, 바퀴, 꽃잎)을 인식합니다.</p>
      <div id="cnn-deep-maps" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:1rem;justify-content:center;"></div>
      <p style="font-size:0.78rem;color:var(--muted);margin-top:0.5rem;text-align:center;" id="cnn-deep-info"></p></div>
    </div>

    <div id="cnn-step-5" class="cnn-step" style="display:none;">
      <div class="card"><h3>6단계: Softmax 분류</h3>
      <p>모든 특징을 종합하여 각 클래스의 확률을 계산합니다.</p>
      <div class="math" style="text-align:center;font-size:0.72rem;">Softmax(zᵢ) = exp(zᵢ) / Σ exp(zⱼ)</div>
      <div id="cnn-predictions" style="margin-top:1rem;">
        <p style="color:var(--muted);font-size:0.85rem;">이미지를 업로드하면 분류 결과가 표시됩니다.</p>
      </div></div>
    </div>
  </div>

</div>
