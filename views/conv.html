<!-- ═══════════ CONV ═══════════ -->
<div class="view" id="v-conv">
  <p class="mono" style="margin-bottom:0.4rem;">합성곱 연산</p>
  <h2>CNN의 핵심 — 아다마르 곱</h2>
  <p class="desc">
    같은 크기의 두 행렬에서 동일 위치의 성분끼리 곱한 후 모두 더하는 연산입니다.
    필터가 이미지 위를 한 칸씩 이동하며 이 연산을 반복하여 특징 맵을 생성합니다.
  </p>

  <div class="card">
    <h3>합성곱이 왜 중요한가?</h3>
    <p>기존 방식(해밍 거리)은 픽셀 위치를 하나하나 비교하기 때문에, 같은 숫자라도 위치가 조금만 달라지면 전혀 다른 것으로 판단합니다. 합성곱은 이미지의 부분적 패턴(가로선, 세로선, 모서리 등)을 찾아내기 때문에 위치 변화에 강하고, 이것이 CNN이 이미지 인식에 뛰어난 핵심 이유입니다.</p>
    <p style="margin-top:0.5rem;">합성곱 신경망(CNN)은 1989년 얀 르쿤(Yann LeCun)이 손글씨 숫자 인식을 위해 제안한 이래, 의료 영상 진단, 자율주행 차량의 물체 인식, 얼굴 인식, 위성 사진 분석 등 시각 정보를 다루는 거의 모든 AI 분야에서 사용됩니다.</p>
  </div>

  <!-- ═══ Interactive Eye vs CNN comparison ═══ -->
  <div class="card">
    <h3>인간의 시각 vs CNN — 단계별 비교</h3>
    <p>이전/다음 버튼을 눌러 각 단계가 누적됩니다. 캔버스를 드래그하여 이동하고, 스크롤(또는 핀치)으로 확대/축소할 수 있습니다.</p>
    <div style="display:flex;justify-content:center;gap:0.5rem;margin:0.8rem 0;">
      <button class="btn" id="ec-tab-eye" onclick="ecSwitchTab('eye')" style="font-weight:600;">인간의 시각</button>
      <button class="btn" id="ec-tab-cnn" onclick="ecSwitchTab('cnn')">CNN 인공신경망</button>
      <span style="width:1px;background:var(--border);margin:0 0.3rem;"></span>
      <button class="btn" onclick="ecPrev()">← 이전</button>
      <span id="ec-label" style="font-family:var(--mono);font-size:0.82rem;font-weight:600;min-width:4rem;text-align:center;line-height:2.2;">0 / 5</span>
      <button class="btn pri" onclick="ecNext()">다음 →</button>
    </div>
    <div id="ec-panel-eye">
      <div class="ec-canvas-wrap" id="ec-wrap-eye" style="position:relative;overflow:hidden;border-radius:var(--radius);border:1px solid var(--border);cursor:grab;touch-action:none;height:420px;">
        <canvas id="eye-cv" width="800" height="520" style="position:absolute;top:0;left:0;transform-origin:0 0;"></canvas>
      </div>
      <div style="display:flex;justify-content:flex-end;gap:0.4rem;margin-top:0.3rem;">
        <button class="btn" onclick="ecZoom('eye',-1)" style="padding:0.2rem 0.6rem;font-size:0.75rem;">−</button>
        <button class="btn" onclick="ecZoom('eye',0)" style="padding:0.2rem 0.6rem;font-size:0.75rem;">맞춤</button>
        <button class="btn" onclick="ecZoom('eye',1)" style="padding:0.2rem 0.6rem;font-size:0.75rem;">+</button>
      </div>
      <div id="eye-desc" style="margin-top:0.5rem;"></div>
    </div>
    <div id="ec-panel-cnn" style="display:none;">
      <div class="ec-canvas-wrap" id="ec-wrap-cnn" style="position:relative;overflow:hidden;border-radius:var(--radius);border:1px solid var(--border);cursor:grab;touch-action:none;height:340px;">
        <canvas id="cnn-cv" width="800" height="400" style="position:absolute;top:0;left:0;transform-origin:0 0;"></canvas>
      </div>
      <div style="display:flex;justify-content:flex-end;gap:0.4rem;margin-top:0.3rem;">
        <button class="btn" onclick="ecZoom('cnn',-1)" style="padding:0.2rem 0.6rem;font-size:0.75rem;">−</button>
        <button class="btn" onclick="ecZoom('cnn',0)" style="padding:0.2rem 0.6rem;font-size:0.75rem;">맞춤</button>
        <button class="btn" onclick="ecZoom('cnn',1)" style="padding:0.2rem 0.6rem;font-size:0.75rem;">+</button>
      </div>
      <div id="cnn-desc" style="margin-top:0.5rem;"></div>
    </div>
  </div>

  <div class="tabs">
    <button class="tab on" onclick="ctab(0,this)">직접 계산</button>
    <button class="tab" onclick="ctab(1,this)">단계별 시각화</button>
    <button class="tab" onclick="ctab(2,this)">CNN 체험</button>
  </div>

  <!-- TAB 0: manual -->
  <div class="tpanel on" id="ct0">
    <div class="card">
      <h3>합성곱 결과를 직접 계산해보세요</h3>
      <p>입력 행렬과 커널의 값을 편집할 수 있습니다. 출력에 답을 입력한 뒤 정답을 확인하세요.</p>
    </div>

    <div class="grid-wrap">
      <div style="text-align:center;"><p class="mat-label">입력 (4×4) — 편집 가능</p><div class="eg" id="mi" style="grid-template-columns:repeat(4,1fr);"></div></div>
      <div class="op">*</div>
      <div style="text-align:center;"><p class="mat-label">커널 (3×3) — 편집 가능</p><div class="eg" id="mk" style="grid-template-columns:repeat(3,1fr);"></div></div>
      <div class="op">=</div>
      <div style="text-align:center;"><p class="mat-label">출력 (2×2) — 답 입력</p><div class="eg" id="mo" style="grid-template-columns:repeat(2,1fr);"></div></div>
    </div>
    <div class="btn-row" style="justify-content:center;">
      <button class="btn pri" onclick="chkMan()">정답 확인</button>
      <button class="btn" onclick="newMan()">새 문제</button>
    </div>
    <div id="mres" class="info" style="text-align:center;display:none;"></div>
    <div id="msol" style="display:none;margin-top:0.8rem;"></div>
  </div>

  <!-- TAB 1: auto viz -->
  <div class="tpanel" id="ct1">
    <div class="card">
      <h3>5×5 입력에 3×3 필터를 적용하는 과정</h3>
      <p>각 단계마다 어떤 성분이 곱해지고 합산되어 출력값이 되는지 확인하세요.</p>
    </div>

    <div class="grid-wrap">
      <div style="text-align:center;"><p class="mat-label">입력 (5×5)</p><div class="mat" id="ai" style="grid-template-columns:repeat(5,1fr);"></div></div>
      <div class="op">×</div>
      <div style="text-align:center;"><p class="mat-label">필터 (3×3)</p><div class="mat" id="ak" style="grid-template-columns:repeat(3,1fr);"></div></div>
      <div class="op">=</div>
      <div style="text-align:center;"><p class="mat-label">특징 맵 (3×3)</p><div class="mat" id="ao" style="grid-template-columns:repeat(3,1fr);"></div></div>
    </div>
    <div class="btn-row" style="justify-content:center;">
      <button class="btn" onclick="aReset()">리셋</button>
      <button class="btn" onclick="aStep()">한 단계</button>
      <button class="btn pri" onclick="aAuto()">자동 재생</button>
    </div>
    <div id="ast" class="status" style="text-align:center;"></div>
    <div id="acalc" class="info" style="text-align:center;">시작 버튼을 눌러 연산 과정을 확인하세요.</div>
  </div>

  <!-- TAB 2: CNN Pipeline -->
  <div class="tpanel" id="ct2">
    <div class="card">
      <h3>CNN 파이프라인 체험</h3>
      <p>이미지를 업로드하면 CNN(합성곱 신경망)이 처리하는 각 단계를 시각적으로 확인할 수 있습니다.</p>
      <div class="upz" id="cnn-upz" style="margin-top:0.8rem;">
        <p style="font-weight:500;color:var(--fg);margin-bottom:0.2rem;">이미지를 드래그하거나 클릭하여 업로드</p>
        <p style="font-size:0.7rem;margin-top:0.15rem;">jpg, png 등 이미지 파일</p>
        <input type="file" id="cnn-fup" accept="image/*">
      </div>
      <div id="cnn-status" class="status"></div>
    </div>

    <div id="cnn-controls" style="display:none;">
      <div id="cnn-timeline" style="display:flex;gap:2px;margin-bottom:0.8rem;overflow-x:auto;padding:0.3rem 0;">
        <button class="cnn-tl-btn" onclick="cnnShowStep(0)" data-step="0">입력<br>이미지</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(1)" data-step="1">Conv2D<br>합성곱</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(2)" data-step="2">ReLU<br>활성화</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(3)" data-step="3">MaxPool<br>풀링</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(4)" data-step="4">Deep<br>깊은 층</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(5)" data-step="5">Softmax<br>분류</button>
      </div>
      <div style="display:flex;justify-content:center;gap:1rem;margin-bottom:1rem;">
        <button class="btn" onclick="cnnPrevStep()">← 이전</button>
        <button class="btn pri" onclick="cnnNextStep()">다음 →</button>
      </div>
    </div>

    <div id="cnn-step-0" class="cnn-step" style="display:none;">
      <div class="card"><h3>1단계: 입력</h3>
      <p>이미지를 224×224로 조정하고 RGB 값을 정규화합니다.</p>
      <div style="text-align:center;margin:1rem 0;">
        <canvas id="cnn-input-cv" width="224" height="224" style="border-radius:var(--radius);border:1px solid var(--border);max-width:224px;"></canvas>
        <p style="font-size:0.78rem;color:var(--muted);margin-top:0.4rem;">224 × 224 × 3 (RGB)</p>
      </div></div>
    </div>
    <div id="cnn-step-1" class="cnn-step" style="display:none;">
      <div class="card"><h3>2단계: 합성곱 — 저수준 특징 추출</h3>
      <p>12개의 필터(커널)가 이미지에서 기본 패턴(가장자리, 방향, 질감)을 감지합니다. 밝은 영역 = 해당 특징이 강하게 존재하는 곳.</p>
      <div id="cnn-conv1-maps" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:1rem;justify-content:center;"></div>
      <p style="font-size:0.78rem;color:var(--muted);margin-top:0.5rem;text-align:center;" id="cnn-conv1-info"></p></div>
    </div>
    <div id="cnn-step-2" class="cnn-step" style="display:none;">
      <div class="card"><h3>3단계: ReLU 활성화</h3>
      <p>음수를 0으로 바꿔 "특징 있음/없음"으로 단순화합니다. 2단계와 비교하면 어두운(음수) 부분이 완전한 검정으로 바뀝니다.</p>
      <div class="math" style="text-align:center;">ReLU(x) = max(0, x)</div>
      <div id="cnn-relu-maps" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:1rem;justify-content:center;"></div></div>
    </div>
    <div id="cnn-step-3" class="cnn-step" style="display:none;">
      <div class="card"><h3>4단계: 맥스 풀링</h3>
      <p>2×2 영역에서 최대값만 선택하여 크기를 절반으로 줄입니다. (224×224 → 112×112)</p>
      <div id="cnn-pool-maps" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:1rem;justify-content:center;"></div>
      <p style="font-size:0.78rem;color:var(--muted);margin-top:0.5rem;text-align:center;" id="cnn-pool-info"></p></div>
    </div>
    <div id="cnn-step-4" class="cnn-step" style="display:none;">
      <div class="card"><h3>5단계: 깊은 층 — 고수준 특징</h3>
      <p>Conv→ReLU→Pool을 반복하면 점점 추상적인 패턴(눈, 바퀴, 꽃잎)을 인식합니다.</p>
      <div id="cnn-deep-maps" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:1rem;justify-content:center;"></div>
      <p style="font-size:0.78rem;color:var(--muted);margin-top:0.5rem;text-align:center;" id="cnn-deep-info"></p></div>
    </div>
    <div id="cnn-step-5" class="cnn-step" style="display:none;">
      <div class="card"><h3>6단계: Softmax 분류</h3>
      <p>모든 특징을 종합하여 각 클래스의 확률을 계산합니다.</p>
      <div class="math" style="text-align:center;font-size:0.72rem;">Softmax(zᵢ) = exp(zᵢ) / Σ exp(zⱼ)</div>
      <div id="cnn-predictions" style="margin-top:1rem;">
        <p style="color:var(--muted);font-size:0.85rem;">이미지를 업로드하면 분류 결과가 표시됩니다.</p>
      </div></div>
    </div>
  </div>

  <div class="math" style="margin-top:2rem;">Y = Σᵢ Σⱼ (Kᵢⱼ × Xᵢⱼ)

K: 필터(커널)  X: 입력의 일부  Y: 출력값
벡터로 펼치면 내적과 동일 — Y가 클수록 해당 영역이 필터 패턴과 유사</div>
</div>