<!-- ══════════════════════════════════════════════
       NEW BLOCK: 아다마르 곱 vs 행렬의 곱
  ══════════════════════════════════════════════ -->
  <div class="card" style="border-left:4px solid var(--blue);">
    <h3>📐 아다마르 곱 vs 행렬의 곱 — 어떻게 다를까?</h3>
    <p style="margin-bottom:1.2rem;">행렬을 다루는 곱셈에는 두 가지가 있습니다.
       생긴 건 비슷해 보여도 계산 방법과 의미가 완전히 다릅니다.</p>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1.4rem;">
      <!-- 아다마르 곱 -->
      <div style="background:var(--bg);border-radius:var(--radius);padding:1.1rem;
                  border:1.5px solid var(--blue);">
        <div style="font-family:var(--mono);font-size:0.6rem;color:var(--blue);
                    letter-spacing:0.12em;text-transform:uppercase;margin-bottom:0.5rem;">
          아다마르 곱 (Hadamard Product)
        </div>
        <div style="font-size:0.95rem;font-weight:700;margin-bottom:0.6rem;">
          같은 위치끼리 곱하기 ⊙
        </div>
        <p style="font-size:0.82rem;color:var(--muted);margin-bottom:0.8rem;">
          두 행렬의 <strong>크기가 반드시 같아야</strong> 하며,
          대응하는 위치의 성분끼리만 곱합니다. 결과 크기는 입력과 동일합니다.
        </p>
        <!-- 수식 블록 -->
        <div class="math" style="font-size:0.75rem;line-height:2;">
(A ⊙ B)ᵢⱼ  =  Aᵢⱼ × Bᵢⱼ
예)  A = [a  b]    B = [e  f]
         [c  d]        [g  h]
A ⊙ B = [a×e   b×f]
        [c×g   d×h]
        </div>
        <!-- 숫자 예시 (1×5=5, 2×6=12, ...) -->
        <!-- CNN에서의 역할 설명 박스 -->
      </div>
      <!-- 행렬의 곱 -->
      <div style="background:var(--bg);border-radius:var(--radius);padding:1.1rem;
                  border:1.5px solid var(--red);">
        <div style="font-family:var(--mono);font-size:0.6rem;color:var(--red);
                    letter-spacing:0.12em;text-transform:uppercase;margin-bottom:0.5rem;">
          행렬의 곱 (Matrix Multiplication)
        </div>
        <div style="font-size:0.95rem;font-weight:700;margin-bottom:0.6rem;">
          행 × 열 내적 ×
        </div>
        <p style="font-size:0.82rem;color:var(--muted);margin-bottom:0.8rem;">
          앞 행렬의 <strong>열 수 = 뒤 행렬의 행 수</strong>이어야 하며,
          행과 열의 내적으로 계산합니다. 결과 크기가 달라집니다.
        </p>
        <!-- 수식 블록 -->
        <div class="math" style="font-size:0.75rem;line-height:2;">
(AB)ᵢⱼ  =  Σₖ Aᵢₖ × Bₖⱼ
예)  A = [a  b]    B = [e  f]
         [c  d]        [g  h]
AB = [a×e+b×g   a×f+b×h]
     [c×e+d×g   c×f+d×h]
        </div>
        <!-- 숫자 예시 (1×5+2×7=19, ...) -->
        <!-- 완전연결층 설명 박스 -->
      </div>
    </div> <!-- /grid -->
    <!-- 핵심 차이 요약 표 -->
    <table style="border-collapse:collapse;width:100%;font-size:0.82rem;">
      <thead>
        <tr style="background:var(--fg);color:var(--bg);">
          <th>구분</th>
          <th>아다마르 곱 ⊙</th>
          <th>행렬의 곱 ×</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>조건</td><td>두 행렬의 크기가 동일</td><td>A의 열 수 = B의 행 수</td></tr>
        <tr><td>계산 방법</td><td>같은 위치 성분끼리 곱</td><td>행 × 열 내적 후 합산</td></tr>
        <tr><td>결과 크기</td><td>입력과 동일 (m×n)</td><td>m×n × n×p = m×p</td></tr>
        <tr><td>교환법칙</td><td>✅ A ⊙ B = B ⊙ A</td><td>❌ AB ≠ BA (일반적으로)</td></tr>
        <tr><td>CNN에서 사용</td><td>합성곱층 (필터 적용)</td><td>완전연결층 (분류)</td></tr>
      </tbody>
    </table>
    <!-- CNN 흐름 코드 블록 -->
    <div class="math" style="font-size:0.76rem;line-height:2.1;">
// CNN 합성곱 한 칸의 계산 순서
Step 1.  픽셀 창과 커널을 아다마르 곱 ⊙ → 자리별 곱셈 행렬
Step 2.  곱셈 행렬의 모든 성분을 합산 (Σ) → 출력값 하나
Step 3.  필터를 한 칸 이동 → Step 1 반복
// 이 두 단계를 묶으면
출력값 Y = Σᵢⱼ (Kᵢⱼ × Xᵢⱼ)  ← 아다마르 곱의 총합 = 내적
    </div>
    <!-- info 박스: 합성곱 = 아다마르 곱의 전체 합 = 내적 -->
    <div class="info" style="margin-top:1rem;margin-bottom:0;">
      <strong>정리:</strong> 합성곱의 핵심은 <em>아다마르 곱 → 합산</em>의 두 단계입니다.
      아다마르 곱으로 "이 위치에 이 특징이 얼마나 있나?"를 자리별로 측정하고,
      합산으로 그 정도를 하나의 숫자로 압축합니다.
      즉, <strong>합성곱 = 아다마르 곱의 전체 합 = 두 행렬의 내적</strong>입니다.
    </div>
  </div>

  <!-- ═══ Interactive Eye vs CNN comparison ═══ -->
  <div class="card">
    <h3>인간의 시각 vs CNN — 단계별 비교</h3>
    <p>이전/다음 버튼을 눌러 각 단계가 누적됩니다. 두 화면이 같은 단계로 함께 진행되며, 각 캔버스는 드래그로 이동하고 스크롤(또는 핀치)로 확대/축소할 수 있습니다.</p>
    <div style="display:flex;justify-content:center;gap:0.5rem;margin:0.8rem 0;flex-wrap:wrap;">
      <button class="btn" onclick="ecPrev()">← 이전</button>
      <span id="ec-label" style="font-family:var(--mono);font-size:0.82rem;font-weight:600;min-width:4rem;text-align:center;line-height:2.2;">0 / 5</span>
      <button class="btn pri" onclick="ecNext()">다음 →</button>
    </div>

    <div id="ec-dual" class="ec-dual">
      <div class="ec-col">
        <div class="ec-title">인간의 시각</div>
        <div class="ec-canvas-wrap" id="ec-wrap-eye" style="position:relative;overflow:hidden;border-radius:var(--radius);border:1px solid var(--border);cursor:grab;touch-action:none;height:420px;">
          <canvas id="eye-cv" width="800" height="520" style="position:absolute;top:0;left:0;transform-origin:0 0;"></canvas>
        </div>
        <div style="display:flex;justify-content:flex-end;gap:0.4rem;margin-top:0.3rem;">
          <button class="btn" onclick="ecZoom('eye',-1)" style="padding:0.2rem 0.6rem;font-size:0.75rem;">−</button>
          <button class="btn" onclick="ecZoom('eye',0)" style="padding:0.2rem 0.6rem;font-size:0.75rem;">맞춤</button>
          <button class="btn" onclick="ecZoom('eye',1)" style="padding:0.2rem 0.6rem;font-size:0.75rem;">+</button>
        </div>
        <div id="eye-desc" style="margin-top:0.5rem;"></div>
      </div>

      <div class="ec-col">
        <div class="ec-title">CNN 인공신경망</div>
        <div class="ec-canvas-wrap" id="ec-wrap-cnn" style="position:relative;overflow:hidden;border-radius:var(--radius);border:1px solid var(--border);cursor:grab;touch-action:none;height:420px;">
          <canvas id="cnn-cv" width="800" height="400" style="position:absolute;top:0;left:0;transform-origin:0 0;"></canvas>
        </div>
        <div style="display:flex;justify-content:flex-end;gap:0.4rem;margin-top:0.3rem;">
          <button class="btn" onclick="ecZoom('cnn',-1)" style="padding:0.2rem 0.6rem;font-size:0.75rem;">−</button>
          <button class="btn" onclick="ecZoom('cnn',0)" style="padding:0.2rem 0.6rem;font-size:0.75rem;">맞춤</button>
          <button class="btn" onclick="ecZoom('cnn',1)" style="padding:0.2rem 0.6rem;font-size:0.75rem;">+</button>
        </div>
        <div id="cnn-desc" style="margin-top:0.5rem;"></div>
      </div>
    </div>
  </div>
<div class="tabs">
    <button class="tab on" onclick="ctab(0,this)">직접 계산</button>
    <button class="tab" onclick="ctab(1,this)">단계별 시각화</button>
    <button class="tab" onclick="ctab(2,this)">CNN 체험</button>
  </div>

  <!-- TAB 0: manual -->
  <div class="tpanel on" id="ct0">
    <div class="card">
      <h3>합성곱 결과를 직접 계산해보세요</h3>
      <p>입력 행렬과 커널의 값을 편집할 수 있습니다. 출력에 답을 입력한 뒤 정답을 확인하세요.</p>
    </div>

    <div class="grid-wrap">
      <div style="text-align:center;"><p class="mat-label">입력 (4×4) — 편집 가능</p><div class="eg" id="mi" style="grid-template-columns:repeat(4,1fr);"></div></div>
      <div class="op">*</div>
      <div style="text-align:center;"><p class="mat-label">커널 (3×3) — 편집 가능</p><div class="eg" id="mk" style="grid-template-columns:repeat(3,1fr);"></div></div>
      <div class="op">=</div>
      <div style="text-align:center;"><p class="mat-label">출력 (2×2) — 답 입력</p><div class="eg" id="mo" style="grid-template-columns:repeat(2,1fr);"></div></div>
    </div>
    <div class="btn-row" style="justify-content:center;">
      <button class="btn pri" onclick="chkMan()">정답 확인</button>
      <button class="btn" onclick="newMan()">새 문제</button>
    </div>
    <div id="mres" class="info" style="text-align:center;display:none;"></div>
    <div id="msol" style="display:none;margin-top:0.8rem;"></div>
  </div>

  <!-- TAB 1: auto viz -->
  <div class="tpanel" id="ct1">
    <div class="card">
      <h3>5×5 입력에 3×3 필터를 적용하는 과정</h3>
      <p>각 단계마다 어떤 성분이 곱해지고 합산되어 출력값이 되는지 확인하세요.</p>
    </div>

    <div class="grid-wrap">
      <div style="text-align:center;"><p class="mat-label">입력 (5×5)</p><div class="mat" id="ai" style="grid-template-columns:repeat(5,1fr);"></div></div>
      <div class="op">×</div>
      <div style="text-align:center;"><p class="mat-label">필터 (3×3)</p><div class="mat" id="ak" style="grid-template-columns:repeat(3,1fr);"></div></div>
      <div class="op">=</div>
      <div style="text-align:center;"><p class="mat-label">특징 맵 (3×3)</p><div class="mat" id="ao" style="grid-template-columns:repeat(3,1fr);"></div></div>
    </div>
    <div class="btn-row" style="justify-content:center;">
      <button class="btn" onclick="aReset()">리셋</button>
      <button class="btn" onclick="aStep()">한 단계</button>
      <button class="btn pri" onclick="aAuto()">자동 재생</button>
    </div>
    <div id="ast" class="status" style="text-align:center;"></div>
    <div id="acalc" class="info" style="text-align:center;">시작 버튼을 눌러 연산 과정을 확인하세요.</div>
  </div>

  <!-- TAB 2: CNN Pipeline -->
  <div class="tpanel" id="ct2">
    <div class="card">
      <h3>CNN 파이프라인 체험</h3>
      <p>이미지를 업로드하면 CNN(합성곱 신경망)이 처리하는 각 단계를 시각적으로 확인할 수 있습니다.</p>
      <div class="upz" id="cnn-upz" style="margin-top:0.8rem;">
        <p style="font-weight:500;color:var(--fg);margin-bottom:0.2rem;">이미지를 드래그하거나 클릭하여 업로드</p>
        <p style="font-size:0.7rem;margin-top:0.15rem;">jpg, png 등 이미지 파일</p>
        <input type="file" id="cnn-fup" accept="image/*">
      </div>
      <div id="cnn-status" class="status"></div>
    </div>

    <div id="cnn-controls" style="display:none;">
      <div id="cnn-timeline" style="display:flex;gap:2px;margin-bottom:0.8rem;overflow-x:auto;padding:0.3rem 0;">
        <button class="cnn-tl-btn" onclick="cnnShowStep(0)" data-step="0">입력<br>이미지</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(1)" data-step="1">Conv2D<br>합성곱</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(2)" data-step="2">ReLU<br>활성화</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(3)" data-step="3">MaxPool<br>풀링</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(4)" data-step="4">Deep<br>깊은 층</button>
        <button class="cnn-tl-btn" onclick="cnnShowStep(5)" data-step="5">Softmax<br>분류</button>
      </div>
      <div style="display:flex;justify-content:center;gap:1rem;margin-bottom:1rem;">
        <button class="btn" onclick="cnnPrevStep()">← 이전</button>
        <button class="btn pri" onclick="cnnNextStep()">다음 →</button>
      </div>
    </div>

    <div id="cnn-step-0" class="cnn-step" style="display:none;">
      <div class="card"><h3>1단계: 입력</h3>
      <p>이미지를 224×224로 조정하고 RGB 값을 정규화합니다.</p>
      <div style="text-align:center;margin:1rem 0;">
        <canvas id="cnn-input-cv" width="224" height="224" style="border-radius:var(--radius);border:1px solid var(--border);max-width:224px;"></canvas>
        <p style="font-size:0.78rem;color:var(--muted);margin-top:0.4rem;">224 × 224 × 3 (RGB)</p>
      </div></div>
    </div>
    <div id="cnn-step-1" class="cnn-step" style="display:none;">
      <div class="card"><h3>2단계: 합성곱 — 저수준 특징 추출</h3>
      <p>12개의 필터(커널)가 이미지에서 기본 패턴(가장자리, 방향, 질감)을 감지합니다. 밝은 영역 = 해당 특징이 강하게 존재하는 곳.</p>
      <div id="cnn-conv1-maps" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:1rem;justify-content:center;"></div>
      <p style="font-size:0.78rem;color:var(--muted);margin-top:0.5rem;text-align:center;" id="cnn-conv1-info"></p></div>
    </div>
    <div id="cnn-step-2" class="cnn-step" style="display:none;">
      <div class="card"><h3>3단계: ReLU 활성화</h3>
      <p>음수를 0으로 바꿔 "특징 있음/없음"으로 단순화합니다. 2단계와 비교하면 어두운(음수) 부분이 완전한 검정으로 바뀝니다.</p>
      <div class="math" style="text-align:center;">ReLU(x) = max(0, x)</div>
      <div id="cnn-relu-maps" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:1rem;justify-content:center;"></div></div>
    </div>
    <div id="cnn-step-3" class="cnn-step" style="display:none;">
      <div class="card"><h3>4단계: 맥스 풀링</h3>
      <p>2×2 영역에서 최대값만 선택하여 크기를 절반으로 줄입니다. (224×224 → 112×112)</p>
      <div id="cnn-pool-maps" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:1rem;justify-content:center;"></div>
      <p style="font-size:0.78rem;color:var(--muted);margin-top:0.5rem;text-align:center;" id="cnn-pool-info"></p></div>
    </div>
    <div id="cnn-step-4" class="cnn-step" style="display:none;">
      <div class="card"><h3>5단계: 깊은 층 — 고수준 특징</h3>
      <p>Conv→ReLU→Pool을 반복하면 점점 추상적인 패턴(눈, 바퀴, 꽃잎)을 인식합니다.</p>
      <div id="cnn-deep-maps" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:1rem;justify-content:center;"></div>
      <p style="font-size:0.78rem;color:var(--muted);margin-top:0.5rem;text-align:center;" id="cnn-deep-info"></p></div>
    </div>
    <div id="cnn-step-5" class="cnn-step" style="display:none;">
      <div class="card"><h3>6단계: Softmax 분류</h3>
      <p>모든 특징을 종합하여 각 클래스의 확률을 계산합니다.</p>
      <div class="math" style="text-align:center;font-size:0.72rem;">Softmax(zᵢ) = exp(zᵢ) / Σ exp(zⱼ)</div>
      <div id="cnn-predictions" style="margin-top:1rem;">
        <p style="color:var(--muted);font-size:0.85rem;">이미지를 업로드하면 분류 결과가 표시됩니다.</p>
      </div></div>
    </div>
  </div>

  <div class="math" style="margin-top:2rem;">Y = Σᵢ Σⱼ (Kᵢⱼ × Xᵢⱼ)

K: 필터(커널)  X: 입력의 일부  Y: 출력값
벡터로 펼치면 내적과 동일 — Y가 클수록 해당 영역이 필터 패턴과 유사</div>
</div>
